# 既存のRaspberry Pi OSへのSSH有効化＆追加インストールガイド

---

## 🚀 はじめに

「すでにRaspberry Piを使っていて、OSもインストール済みだけど、BCNOFNeシステムを追加したい！」

このガイドは、そんなあなたのために作られました。

新品のmicroSDカードから始めるのではなく、**現在お使いの環境に、後からSSHを有効化し、BCNOFNeシステムを安全に追加インストールする**方法を解説します。

### このガイドでできること

1. ✅ **モニターとキーボードを使ってSSHを有効化**する方法がわかる
2. ✅ **PCだけでSSHを有効化（ヘッドレス設定）**する方法がわかる
3. ✅ 既存の環境にBCNOFNeシステムをインストールする手順がわかる

---

## 1. SSHを有効化する - 2つの方法

SSH（遠隔操作）が有効になっていないと、PCからRaspberry Piを操作できません。お使いの状況に合わせて、どちらかの方法でSSHを有効にしてください。

### 方法A: モニターとキーボードがある場合（一番簡単）

Raspberry Piにモニター、キーボード、マウスを接続して直接操作できる方向けです。

1.  **Raspberry Piを起動**し、デスクトップ画面またはコマンドラインを開きます。

2.  **ターミナルを開きます。**
    - デスクトップ画面の場合: 画面左上の黒いターミナルアイコンをクリックします。

3.  以下のコマンドを入力して、Raspberry Piの設定ツールを起動します。

    ```bash
    sudo raspi-config
    ```

4.  青い設定画面が表示されます。キーボードの矢印キーで操作します。
    - `3 Interface Options` を選択してEnterキーを押します。

    ![raspi-config main menu](https://i.imgur.com/3ZJzQ3m.png)

5.  次に、`I2 SSH` を選択してEnterキーを押します。

    ![raspi-config interface options](https://i.imgur.com/s4pB1a7.png)

6.  「Would you like the SSH server to be enabled?」という質問が表示されたら、`<Yes>` を選択してEnterキーを押します。

    ![Enable SSH confirmation](https://i.imgur.com/J8b3hRA.png)

7.  「The SSH server is enabled」と表示されたら成功です。`<Ok>` を選択してEnterキーを押します。

8.  元の画面に戻ったら、`Finish` を選択して設定ツールを終了します。再起動を求められたら `<Yes>` を選択してください。

これで、あなたのRaspberry PiでSSHが有効になりました！

### 方法B: PCしかない場合（ヘッドレス設定）

モニターやキーボードが手元になく、PCだけで設定を完結させたい方向けです。

1.  **Raspberry Piの電源を切り**、microSDカードを取り出します。

2.  PCにmicroSDカードを接続します。

3.  エクスプローラー（Windows）またはFinder（Mac）で、microSDカードの中身を表示します。
    - `boot` という名前のドライブ（パーティション）が見えるはずです。

4.  **`boot` ドライブの直下に、`ssh` という名前の空のファイルを作成します。**

    - **重要**: ファイル名は `ssh` だけで、拡張子（`.txt`など）は付けないでください。

    #### Windowsでの作成方法
    1. `boot` ドライブ内で右クリック → `新規作成` → `テキスト ドキュメント` を選択。
    2. `新しいテキスト ドキュメント.txt` というファイルができるので、名前を `ssh` に変更します。
    3. 「拡張子を変更すると、ファイルが使えなくなる可能性があります。」と警告が出たら、「はい」を選択します。
       - **もし拡張子 `.txt` が見えない場合**: エクスプローラーの `表示` タブ → `ファイル名拡張子` にチェックを入れてください。

    #### Macでの作成方法
    1. ターミナルを起動します。
    2. 以下のコマンドを実行します。（`BOOTNAME` は実際の`boot`ドライブの名前に置き換えてください）
       ```bash
       touch /Volumes/BOOTNAME/ssh
       ```

5.  ファイルが作成できたら、PCからmicroSDカードを安全に取り出します。

6.  Raspberry PiにmicroSDカードを戻し、電源を入れます。

Raspberry Piは起動時に `ssh` ファイルの存在を検知し、**自動的にSSHを有効にしてから、そのファイルを削除します。** これで、SSHが有効になりました。

---

## 2. 既存環境へのインストール手順

SSHを有効にしたら、いよいよBCNOFNeシステムをインストールします。

### ステップ1: SSHで接続する

まず、Raspberry PiのIPアドレスを特定し、PCからSSHで接続します。

> この手順がわからない場合は、**[📄 SSH接続とIPアドレスの謎](./SSH_IP_GUIDE.md)** を参照してください。

```bash
# ユーザー名はデフォルトだと `pi` です
ssh pi@<あなたのRaspberryPiのIPアドレス>
```

### ステップ2: システムの更新

まず、既存のシステムを最新の状態にします。これにより、後のインストールがスムーズに進みます。

```bash
sudo apt update && sudo apt full-upgrade -y
```

### ステップ3: BCNOFNeシステムのインストール

ここから先は、基本的に **[📄 INSTALL_GUIDE_ULTIMATE.md](./INSTALL_GUIDE_ULTIMATE.md)** の **「第3部: BCNOFNeの進水」** と同じ手順です。

1.  **ファイルのダウンロードと展開**
    - `git` や `unzip` が既にあれば、インストールのコマンドは不要です。
    - `scp` などで `autonomous_ai_BCNOFNe_system_ultimate.zip` を転送し、展開します。

2.  **必要なソフトウェアのインストール**
    - `pip3 install -r requirements.txt` などを実行します。
    - 既存の環境によっては、すでにインストール済みのパッケージがあるかもしれませんが、問題ありません。

3.  **環境変数の設定**
    - `.env` ファイルを作成し、APIキーなどを設定します。

4.  **ハードウェア設定**
    - `sudo raspi-config` でI2Cなどを有効化します。

5.  **自動起動サービスの設定**
    - systemdサービスファイルをコピーし、有効化します。

6.  **Tailscaleのインストール**
    - インストールスクリプトを実行します。

### ステップ4: 再起動と動作確認

すべての手順が完了したら、Raspberry Piを再起動します。

```bash
sudo reboot
```

再起動後、`systemctl status` コマンドで各サービスが正常に動作しているか確認してください。

---

## 💡 注意点

- **ポートの競合**: もし既存の環境でWebサーバー（ポート80, 443）や他のサービスが動いている場合、BCNOFNeシステムの機能と競合する可能性があります。その場合は、設定ファイルを調整する必要があります。
- **リソース消費**: BCNOFNeシステムは、特にAIが活発に動作しているときにCPUやメモリを消費します。既存のアプリケーションと同時に動かす場合は、リソースの監視を推奨します（OLED表示機能が役立ちます）。

これで、あなたの既存のRaspberry Pi環境が、強力なAIアシスタントを搭載した究極のサーバーに生まれ変わりました！
